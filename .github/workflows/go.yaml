name: RUSTDESK_GOFILE_GO
on:
  workflow_dispatch:

jobs:
  rdp:
    runs-on: windows-latest
    steps:
      - name: 1. Instalar RustDesk
        shell: pwsh
        run: |
          $url = "https://github.com/rustdesk/rustdesk/releases/download/1.3.1/rustdesk-1.3.1-x86_64.msi"
          Invoke-WebRequest -Uri $url -OutFile "rd.msi"
          Start-Process msiexec.exe -ArgumentList "/i","rd.msi","/quiet","/norestart" -Wait

      - name: 2. Captura y Subida a Gofile
        shell: pwsh
        run: |
          $rd = "C:\Program Files\RustDesk\rustdesk.exe"
          & $rd --password "boosito123"
          Start-Sleep -Seconds 20
          
          # Captura de pantalla
          Add-Type -AssemblyName System.Windows.Forms, System.Drawing
          $s = [System.Windows.Forms.Screen]::PrimaryScreen.Bounds
          $b = New-Object System.Drawing.Bitmap($s.Width, $s.Height)
          $g = [System.Drawing.Graphics]::FromImage($b)
          $g.CopyFromScreen(0,0,0,0,$b.Size)
          $p = "$env:TEMP\screenshot.png"
          $b.Save($p, [System.Drawing.Imaging.ImageFormat]::Png)
          $g.Dispose(); $b.Dispose()
          
          # Subida a Gofile
          # Primero obtenemos un servidor disponible
          $server = (Invoke-RestMethod -Uri "https://api.gofile.io/servers").data.servers[0].name
          # Subimos el archivo
          $upload = curl.exe -F "file=@$p" "https://$($server).gofile.io/contents/uploadfile"
          $downloadLink = ($upload | ConvertFrom-Json).data.downloadPage
          
          Write-Host "========================================"
          Write-Host "ðŸ”— ENLACE GOFILE: $downloadLink"
          Write-Host "ðŸ”‘ CONTRASEÃ‘A: boosito123"
          Write-Host "========================================"

      - name: 3. Loop Infinito
        shell: pwsh
        run: |
          Write-Host "Corriendo..."
          while($true) { Start-Sleep 60 }

