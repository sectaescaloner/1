name: WIN11_RTX5090_TOTAL_CONVERSION
on: 
  workflow_dispatch:

jobs:
  deploy:
    runs-on: windows-latest
    timeout-minutes: 360
    steps:
      - name: ðŸš€ 1. CORE HARDWARE (RTX 5090)
        shell: powershell
        run: |
          Write-Host "[*] INYECTANDO HARDWARE GAMER..." -ForegroundColor Cyan

          # --- GPU SPOOF ---
          $videoClass = "HKLM:\SYSTEM\CurrentControlSet\Control\Class\{4d36e968-e325-11ce-bfc1-08002be10318}"
          Get-ChildItem -Path $videoClass -ErrorAction SilentlyContinue | ForEach-Object {
              $path = $_.PSPath
              $desc = ($_ | Get-ItemProperty -Name "DriverDesc" -ErrorAction SilentlyContinue).DriverDesc
              if ($desc -match "Microsoft" -or $desc -match "Hyper-V" -or $desc -match "Display") {
                  Set-ItemProperty -Path $path -Name "DriverDesc" -Value "NVIDIA GeForce RTX 5090" -Force
                  Set-ItemProperty -Path $path -Name "ProviderName" -Value "NVIDIA" -Force
                  Set-ItemProperty -Path $path -Name "HardwareInformation.ChipType" -Value "NVIDIA GeForce RTX 5090" -Force
                  Set-ItemProperty -Path $path -Name "MatchingDeviceId" -Value "PCI\VEN_10DE&DEV_2684" -Force
                  # 32GB VRAM
                  New-ItemProperty -Path $path -Name "HardwareInformation.QwMemorySize" -Value 34359738368 -PropertyType QWord -Force
              }
          }

          # --- CPU & BIOS ---
          Set-ItemProperty -Path "HKLM:\HARDWARE\DESCRIPTION\System\BIOS" -Name "SystemManufacturer" -Value "ASUS" -Force
          Set-ItemProperty -Path "HKLM:\HARDWARE\DESCRIPTION\System\BIOS" -Name "SystemProductName" -Value "ROG Strix G16" -Force
          
          Get-ChildItem -Path "HKLM:\HARDWARE\DESCRIPTION\System\CentralProcessor" | ForEach-Object {
              Set-ItemProperty -Path $_.PSPath -Name "ProcessorNameString" -Value "AMD Ryzen 9 7950X3D 16-Core Processor" -Force
          }

      - name: ðŸŽ¨ 2. TOTAL CONVERSION (LOOK & FEEL)
        shell: powershell
        run: |
          Write-Host "[*] Transformando Server a Home..." -ForegroundColor Magenta

          # 1. FONDO DE PANTALLA OFICIAL (BLOOM DARK)
          # Esto es critico: El fondo azul de Server delata todo. El fondo Bloom grita "Windows 11".
          $wallpaperPath = "C:\Users\Public\win11_bloom.jpg"
          Invoke-WebRequest -Uri "https://images.wallpapersden.com/image/download/windows-11-dark-stock-official_bGlmaGaUmZqaraWkpJRmbmdlrWZlbWU.jpg" -OutFile $wallpaperPath
          
          # Codigo C# para aplicar wallpaper instantaneo
          $code = @'
          using System.Runtime.InteropServices;
          public class Wallpaper {
              [DllImport("user32.dll", CharSet = CharSet.Auto)]
              public static extern int SystemParametersInfo(int uAction, int uParam, string lpvParam, int fuWinIni);
          }
          '@
          Add-Type -TypeDefinition $code -MemberDefinition 'public static void Set() { Wallpaper.SystemParametersInfo(20, 0, "C:\\Users\\Public\\win11_bloom.jpg", 3); }' -Name "Wp" -Namespace "Win"
          [Win.Wp]::Set()

          # 2. ACTIVAR EFECTOS VISUALES (VisualFX)
          # Server viene en modo "Rendimiento" (feo). Lo ponemos en "Apariencia".
          $visualEffects = "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\VisualEffects"
          if (!(Test-Path $visualEffects)) { New-Item -Path $visualEffects -Force }
          Set-ItemProperty -Path $visualEffects -Name "VisualFXSetting" -Value 1 -Force 

          # 3. TASKBAR: BARRA DE BUSQUEDA Y TRANSPARENCIA
          $searchKey = "HKCU:\Software\Microsoft\Windows\CurrentVersion\Search"
          Set-ItemProperty -Path $searchKey -Name "SearchboxTaskbarMode" -Value 1 -Force
          
          $personalize = "HKCU:\Software\Microsoft\Windows\CurrentVersion\Themes\Personalize"
          if (!(Test-Path $personalize)) { New-Item -Path $personalize -Force }
          Set-ItemProperty -Path $personalize -Name "EnableTransparency" -Value 1 -Force
          Set-ItemProperty -Path $personalize -Name "AppsUseLightTheme" -Value 0 -Force # Modo Oscuro
          Set-ItemProperty -Path $personalize -Name "SystemUsesLightTheme" -Value 0 -Force

          # 4. OCULTAR MARCA DE AGUA DE EVALUACION/VERSION
          Set-ItemProperty -Path "HKCU:\Control Panel\Desktop" -Name "PaintDesktopVersion" -Value 0 -Force

          Write-Host "[OK] EstÃ©tica Windows 11 Home Dark aplicada."

      - name: ðŸ‡ªðŸ‡¸ 3. REGION RAPIDA
        shell: powershell
        run: |
          Set-Culture es-ES
          Set-WinSystemLocale es-ES
          Set-TimeZone -Id "Romance Standard Time"

      - name: ðŸ”‘ 4. RUSTDESK (ACCESO)
        shell: powershell
        run: |
          curl.exe -L -o rd.msi "https://github.com/rustdesk/rustdesk/releases/download/1.3.1/rustdesk-1.3.1-x86_64.msi"
          Start-Process msiexec.exe -ArgumentList "/i rd.msi /quiet /norestart" -Wait
          Start-Sleep -Seconds 5
          & "C:\Program Files\RustDesk\rustdesk.exe" --password Bullet123
          $id = & "C:\Program Files\RustDesk\rustdesk.exe" --get-id
          Write-Host "========================================"
          Write-Host "ID RUSTDESK: $id"
          Write-Host "PASS:        Bullet123"
          Write-Host "========================================"

      - name: ðŸ“¸ 5. EVIDENCIA
        shell: powershell
        run: |
          Add-Type -AssemblyName System.Windows.Forms
          $screen = [System.Windows.Forms.Screen]::PrimaryScreen.Bounds
          $bitmap = New-Object System.Drawing.Bitmap($screen.Width, $screen.Height)
          $graphics = [System.Drawing.Graphics]::FromImage($bitmap)
          $graphics.CopyFromScreen(0, 0, 0, 0, $bitmap.Size)
          $bitmap.Save("C:\Users\Public\desktop.png")
          $link = curl.exe -F "reqtype=fileupload" -F "fileToUpload=@C:\Users\Public\desktop.png" https://catbox.moe/user/api.php
          Write-Host "SCREENSHOT: $link"

      - name: ðŸ”„ LOOP
        shell: powershell
        run: |
          while($true) { Start-Sleep -Seconds 60 }

