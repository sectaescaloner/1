name: RATA_ULTIMATE_REMOTLY
on: workflow_dispatch

jobs:
  mirillis-heist:
    runs-on: windows-latest
    steps:
      - name: üá®üá± 1. MODIFICAR REGI√ìN Y NOMBRE
        shell: powershell
        run: |
          Set-WinHomeLocation -GeoId 46
          $n = "Glooso"
          Set-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Control\ComputerName\ComputerName" -Name "ComputerName" -Value $n

      - name: üõ°Ô∏è 2. INSTALAR HOPTODESK (MODO SERVICIO / NO ERROR)
        shell: powershell
        run: |
          # Descargamos la versi√≥n 64 bits estable
          $url = "https://download.hoptodesk.com/HopToDesk64.exe"
          $exe = "$env:TEMP\hoptodesk.exe"
          curl.exe -L -o $exe $url
          
          Write-Host "Instalando servicio de HopToDesk..."
          # El truco PRO: Instalar como servicio evita el error de DLL y permite cambiar la pass
          Start-Process -FilePath $exe -ArgumentList "--install" -Verb RunAs -Wait
          
          # Esperamos que el servicio arranque
          Start-Sleep -Seconds 15
          
          # Ruta real del servicio instalado
          $servicePath = "C:\Program Files\HopToDesk\HopToDesk.exe"
          
          if (Test-Path $servicePath) {
              # Seteamos la contrase√±a en el servicio
              & $servicePath --password boosito
              Start-Sleep -Seconds 2
              $id = & $servicePath --get-id
              
              Write-Host "========================================"
              Write-Host "‚úÖ ID HOPTODESK: $id"
              Write-Host "üîë PASS: boosito"
              Write-Host "========================================"
          } else {
              Write-Host "‚ùå Error: No se instal√≥ el servicio. Intentando modo portable..."
              & $exe --password boosito
              $id = & $exe --get-id
              Write-Host "ID (Portable): $id"
          }

      - name: üöÄ 3. INSTALAR REMOTLY (PRE-SETUP)
        shell: powershell
        run: |
          $remotlyUrl = "https://downloads.mirillis.com/files/remotly_pc_1_37_2_setup.exe"
          $dest = "$env:USERPROFILE\Desktop\Instalar_Remotly.exe"
          
          Write-Host "Bajando Remotly de Mirillis..."
          curl.exe -L -o $dest $remotlyUrl
          
          # Lo ejecutamos silencioso pero NO lo matamos, para que instale drivers si puede
          # OJO: Remotly pedir√° instalar 'Mirillis Virtual Display'. 
          # Tendr√°s que darle 'S√≠' manualmentecuando entres por HopToDesk.
          
          # Creamos un script en el escritorio para abrirlo r√°pido si se cierra
          $ws = New-Object -ComObject WScript.Shell
          $s = $ws.CreateShortcut("$env:USERPROFILE\Desktop\ABRIR_REMOTLY.lnk")
          $s.TargetPath = $dest
          $s.Save()

      - name: üì∏ 4. EVIDENCIA DE PANTALLA (Check Visual)
        shell: powershell
        run: |
          Add-Type -AssemblyName System.Windows.Forms, System.Drawing
          $s = [System.Windows.Forms.Screen]::PrimaryScreen.Bounds
          $b = New-Object System.Drawing.Bitmap($s.Width, $s.Height)
          $g = [System.Drawing.Graphics]::FromImage($b)
          $g.CopyFromScreen(0, 0, 0, 0, $b.Size)
          $imgPath = "C:\Users\Public\screen.png"
          $b.Save($imgPath)
          
          $server = (curl.exe -s https://api.gofile.io/servers | ConvertFrom-Json).data.servers[0].name
          $link = (curl.exe -F "file=@$imgPath" "https://$($server).gofile.io/contents/uploadfile" | ConvertFrom-Json).data.downloadPage
          Write-Host "üëÄ MIRA SI SALI√ì EL ID AQU√ç: $link"

      - name: üîÑ 5. LOOP DE MANTENIMIENTO
        shell: powershell
        run: |
          Write-Host "1. Conecta con HopToDesk (ID arriba, Pass: boosito)"
          Write-Host "2. Abre 'Instalar_Remotly' en el escritorio"
          Write-Host "3. Dale 'Install' y luego logu√©ate con tu Gmail"
          Write-Host "4. ¬°Listo! Cierra HopToDesk."
          while($true) { Start-Sleep 60 }

