name: RATA_W11_GLOOSO_GOFILE
on: workflow_dispatch

jobs:
  gaming-heist:
    runs-on: windows-latest
    steps:
      - name: ðŸ‡¨ðŸ‡± 1. REGION CHILE Y NOMBRE GLOOSO
        shell: powershell
        run: |
          Set-WinHomeLocation -GeoId 46
          Set-Culture es-CL
          $n = "Glooso"
          Set-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Control\ComputerName\ComputerName" -Name "ComputerName" -Value $n
          Set-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters" -Name "Hostname" -Value $n

      - name: ðŸ“¥ 2. DESCARGAR REMOTLY
        shell: powershell
        run: |
          $remoteUrl = "https://downloads.mirillis.com/files/remotly_pc_1_37_2_setup.exe"
          $localPath = "$env:USERPROFILE\Downloads\remotly_setup.exe"
          curl.exe -L -o "$localPath" "$remoteUrl"

      - name: ðŸ”‘ 3. INSTALAR RUSTDESK
        shell: powershell
        run: |
          curl.exe -L -o "rd.msi" "https://github.com/rustdesk/rustdesk/releases/download/1.3.1/rustdesk-1.3.1-x86_64.msi"
          Start-Process msiexec.exe -ArgumentList "/i rd.msi /quiet /norestart" -Wait
          Start-Sleep -Seconds 10

      - name: ðŸ”“ 4. CONFIGURAR PASS Y OBTENER ID
        shell: powershell
        run: |
          $exe = "C:\Program Files\RustDesk\rustdesk.exe"
          & "$exe" --password boosito
          Start-Sleep -Seconds 2
          $id = & "$exe" --get-id
          Write-Host "========================================"
          Write-Host "ID RUSTDESK: $id"
          Write-Host "PASS: boosito"
          Write-Host "USER: Glooso"
          Write-Host "========================================"

      - name: ðŸ“¸ 5. EVIDENCIA GOFILE
        shell: powershell
        run: |
          # Captura de pantalla
          Add-Type -AssemblyName System.Windows.Forms, System.Drawing
          $s = [System.Windows.Forms.Screen]::PrimaryScreen.Bounds
          $b = New-Object System.Drawing.Bitmap($s.Width, $s.Height)
          $g = [System.Drawing.Graphics]::FromImage($b)
          $g.CopyFromScreen(0, 0, 0, 0, $b.Size)
          $imgPath = "C:\Users\Public\evidence.png"
          $b.Save($imgPath)

          # Obtener servidor de Gofile
          $serverResp = curl.exe -s https://api.gofile.io/servers
          $server = ($serverResp | ConvertFrom-Json).data.servers[0].name
          
          # Subir archivo
          Write-Host "Subiendo a servidor: $server"
          $uploadResp = curl.exe -F "file=@$imgPath" "https://$($server).gofile.io/contents/uploadfile"
          $downloadPage = ($uploadResp | ConvertFrom-Json).data.downloadPage
          
          Write-Host "----------------------------------------"
          Write-Host "LINK DE CAPTURA (Gofile): $downloadPage"
          Write-Host "----------------------------------------"

      - name: ðŸ”„ LOOP
        shell: powershell
        run: |
          Write-Host "Runner Activo..."
          while($true) { Start-Sleep 60 }

