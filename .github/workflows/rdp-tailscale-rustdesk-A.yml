name: RDP_NGROK_FINAL
on: workflow_dispatch

jobs:
  deploy:
    runs-on: windows-latest
    steps:
      - name: 1. SETUP RDP
        shell: powershell
        run: |
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -Name "fDenyTSConnections" -Value 0
          Enable-NetFirewallRule -DisplayGroup "Remote Desktop"
          net user boosito Parinuxd123 /add
          net localgroup administrators boosito /add

      - name: 2. INSTALAR NGROK (VIA CHOCO)
        shell: powershell
        run: |
          # Instalamos ngrok usando el gestor de paquetes de Windows
          choco install ngrok -y
          
          # Configuramos tu token (El que me pasaste antes)
          ngrok authtoken 393CwGNqE4jpyhdAuvNewGtG58B_5roLoskHKD1jLw4CCigti

      - name: 3. INICIAR TUNEL TCP
        shell: powershell
        run: |
          # Lanzar el tÃºnel al puerto 3389
          Start-Process -FilePath "ngrok" -ArgumentList "tcp", "3389"
          Start-Sleep -Seconds 20

      - name: 4. DIRECCION DE CONEXION
        shell: powershell
        run: |
          $api = curl.exe -s http://localhost:4040/api/tunnels | ConvertFrom-Json
          $url = $api.tunnels[0].public_url
          $cleanUrl = $url.Replace("tcp://", "")
          Write-Host "========================================"
          Write-Host "ðŸ”— IP PARA RDP: $cleanUrl"
          Write-Host "ðŸ‘¤ USER: boosito"
          Write-Host "ðŸ”‘ PASS: Parinuxd123"
          Write-Host "========================================"

      - name: 5. MANTENER VIVO
        shell: powershell
        run: |
          while($true) { Start-Sleep 60 }
          
