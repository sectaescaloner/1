name: RUSTDESK_PARINUX_FIXED
on: workflow_dispatch

jobs:
  deploy:
    runs-on: windows-latest
    steps:
      - name: üó∫Ô∏è 1. UBICACION Y RED
        shell: powershell
        run: |
          $info = curl.exe -s https://ipinfo.io/json | ConvertFrom-Json
          Write-Host "========================================"
          Write-Host "üåç RUNNER EN: $($info.city), $($info.country)"
          Write-Host "üìç IP: $($info.ip)"
          Write-Host "========================================"

      - name: üöÄ 2. INSTALAR RUSTDESK
        shell: powershell
        run: |
          $url = "https://github.com/rustdesk/rustdesk/releases/download/1.3.7/rustdesk-1.3.7-x86_64.exe"
          $exe = "$env:TEMP\rustdesk.exe"
          curl.exe -L -o $exe $url
          # Instalaci√≥n silenciosa
          Start-Process -FilePath $exe -ArgumentList "--install" -Wait
          Start-Sleep -Seconds 10

      - name: üîë 3. CONFIGURAR PASSWORD
        shell: powershell
        run: |
          $rd_exe = "C:\Program Files\RustDesk\rustdesk.exe"
          if (Test-Path $rd_exe) {
              # Seteamos la pass parinuxd
              Start-Process -FilePath $rd_exe -ArgumentList "--password parinuxd" -Wait
              Write-Host "‚úÖ Password 'parinuxd' configurada."
          }

      - name: üì∏ 4. CAPTURA GOFILE (EL ID ESTA AQUI)
        shell: powershell
        run: |
          # Capturar pantalla completa
          Add-Type -AssemblyName System.Windows.Forms, System.Drawing
          $s = [System.Windows.Forms.Screen]::PrimaryScreen.Bounds
          $b = New-Object System.Drawing.Bitmap($s.Width, $s.Height)
          $g = [System.Drawing.Graphics]::FromImage($b)
          $g.CopyFromScreen(0, 0, 0, 0, $b.Size)
          $imgPath = "$env:TEMP\screen.png"
          $b.Save($imgPath)
          
          # Subir a Gofile
          $resp = curl.exe -s https://api.gofile.io/servers | ConvertFrom-Json
          $server = $resp.data.servers[0].name
          $upload = curl.exe -s -F "file=@$imgPath" "https://$($server).gofile.io/contents/uploadfile" | ConvertFrom-Json
          $link = $upload.data.downloadPage
          
          Write-Host "========================================"
          Write-Host "üñºÔ∏è MIRA TU ID EN ESTE LINK: $link"
          Write-Host "üîë PASSWORD: parinuxd"
          Write-Host "========================================"

      - name: üîÑ 5. MANTENER VIVO
        shell: powershell
        run: |
          Write-Host "Runner activo. Con√©ctate usando el ID de la foto."
          while($true) { Start-Sleep 60 }
          
