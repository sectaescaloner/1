name: RUST_ID_VISIBLE
on: workflow_dispatch

jobs:
  deploy:
    runs-on: windows-latest
    steps:
      - name: 1. INFO RED
        shell: powershell
        run: |
          $ip = curl.exe -s https://ifconfig.me
          Write-Host "IP_DEL_RUNNER: $ip"

      - name: 2. EJECUTAR RUSTDESK PORTABLE
        shell: powershell
        run: |
          $url = "https://github.com/rustdesk/rustdesk/releases/download/1.3.7/rustdesk-1.3.7-x86_64.exe"
          $exe = "$env:TEMP\rd.exe"
          curl.exe -L -o $exe $url
          
          Write-Host "Iniciando RustDesk con pass 'parinuxd'..."
          # Lanzar proceso y darle tiempo de sobra
          Start-Process -FilePath $exe -ArgumentList "--password parinuxd"
          Start-Sleep -Seconds 30

      - name: 3. CAPTURA Y EXTRACCI√ìN DE ID
        shell: powershell
        run: |
          $exe = "$env:TEMP\rd.exe"
          
          # Intentar traer RustDesk al frente antes de la captura
          $wshell = New-Object -ComObject WScript.Shell
          $wshell.AppActivate("RustDesk")
          Start-Sleep -Seconds 2
          
          # Captura de pantalla
          Add-Type -AssemblyName System.Windows.Forms, System.Drawing
          $s = [System.Windows.Forms.Screen]::PrimaryScreen.Bounds
          $b = New-Object System.Drawing.Bitmap($s.Width, $s.Height)
          $g = [System.Drawing.Graphics]::FromImage($b)
          $g.CopyFromScreen(0, 0, 0, 0, $b.Size)
          $img = "$env:TEMP\rust_id.png"
          $b.Save($img)
          
          # Intentar obtener ID por texto para el log
          $id = & $exe --get-id
          
          # Subir a Gofile
          $serv = (curl.exe -s https://api.gofile.io/servers | ConvertFrom-Json).data.servers[0].name
          $up = curl.exe -s -F "file=@$img" "https://$($serv).gofile.io/contents/uploadfile" | ConvertFrom-Json
          
          Write-Host "========================================"
          Write-Host "üÜî ID (TEXTO): $id"
          Write-Host "üîë PASS: parinuxd"
          Write-Host "üñºÔ∏è LINK CAPTURA: $($up.data.downloadPage)"
          Write-Host "========================================"

      - name: 4. MANTENER VIVO
        shell: powershell
        run: |
          while($true) { Start-Sleep 60 }

