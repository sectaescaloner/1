name: üêÄ RATA_SUNSHINE_TAILSCALE_V9
on: 
  workflow_dispatch:
    inputs:
      tailscale_key:
        description: 'Tu Auth Key de Tailscale'
        required: true

jobs:
  gaming-heist:
    runs-on: windows-latest
    steps:
      - name: üèéÔ∏è 1. RAM 32GB (M√âTODO REGISTRO)
        shell: powershell
        run: |
          reg add "HKLM\System\CurrentControlSet\Control\Session Manager\Memory Management" /v PagingFiles /t REG_MULTI_SZ /d "D:\pagefile.sys 32768 32768" /f

      - name: üëÅÔ∏è 2. INSTALAR MONITOR VIRTUAL (MODO NINJA)
        shell: powershell
        run: |
          $url = "https://github.com/VirtualDrivers/Virtual-Display-Driver/releases/download/25.5.2/Virtual.Display.Driver-v25.05.03-setup-x64.exe"
          & curl.exe -L -o setup_monitor.exe $url
          # Lanzamos y solo esperamos 30 segundos, si no termina, seguimos
          Start-Process -FilePath ".\setup_monitor.exe" -ArgumentList "/S"
          Start-Sleep -Seconds 30
          Write-Host "[OK] Monitor lanzado (procediendo con el resto)."

      - name: üöá 3. TAILSCALE (BYPASS FIREWALL)
        shell: powershell
        run: |
          choco install tailscale -y
          # Forzamos el arranque y login
          & "C:\Program Files\Tailscale\tailscale.exe" up --authkey ${{ github.event.inputs.tailscale_key }} --unattended
          Write-Host "[OK] Tailscale activo."

      - name: ‚òÄÔ∏è 4. SUNSHINE & GAMING BOOST
        shell: powershell
        run: |
          # Instalamos todo en un solo golpe
          choco install sunshine mesa3d-pal1000 vigembus -y
          Write-Host "[OK] Todo el armamento instalado."

      - name: üìä 5. DATOS DE CONEXI√ìN
        shell: powershell
        run: |
          $ip = & "C:\Program Files\Tailscale\tailscale.exe" ip -4
          Write-Host "========================================"
          Write-Host "IP PARA MOONLIGHT: $ip"
          Write-Host "URL CONFIG SUNSHINE: https://$($ip):47990"
          Write-Host "========================================"

      - name: üîÑ MANTENER VIVO
        run: |
          while($true) { Start-Sleep 60 }
          
