name: RATA_W11_GLOOSO_HOPTODESK
on: workflow_dispatch

jobs:
  gaming-heist:
    runs-on: windows-latest
    steps:
      - name: üá®üá± 1. REGION CHILE Y NOMBRE GLOOSO
        shell: powershell
        run: |
          Set-WinHomeLocation -GeoId 46
          Set-Culture es-CL
          $n = "Glooso"
          Set-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Control\ComputerName\ComputerName" -Name "ComputerName" -Value $n

      - name: üì• 2. DESCARGAR REMOTLY
        shell: powershell
        run: |
          $remoteUrl = "https://downloads.mirillis.com/files/remotly_pc_1_37_2_setup.exe"
          $localPath = "$env:USERPROFILE\Downloads\remotly_setup.exe"
          curl.exe -L -o "$localPath" "$remoteUrl"

      - name: üîë 3. INSTALAR HOPTODESK (Alternativa segura)
        shell: powershell
        run: |
          # Usando el link de 64 bits que proporcionaste
          curl.exe -L -o "hoptodesk.exe" "https://download.hoptodesk.com/HopToDesk64.exe"
          
          # HopToDesk al ser fork usa comandos similares a RustDesk
          # Seteamos la contrase√±a 'boosito'
          ./hoptodesk.exe --password boosito
          Start-Sleep -Seconds 5
          
          # Obtenemos el ID para conectar
          $id = ./hoptodesk.exe --get-id
          Write-Host "========================================"
          Write-Host "ID HOPTODESK: $id"
          Write-Host "PASS: boosito"
          Write-Host "USER: Glooso"
          Write-Host "========================================"

      - name: ‚úàÔ∏è 4. INSTALAR TELEGRAM
        shell: powershell
        run: |
          $url = "https://telegram.org/dl/desktop/win64"
          $dest = "$env:TEMP\telegram_setup.exe"
          $installPath = "C:\TelegramDesktop"
          
          Write-Host "Descargando e Instalando Telegram..."
          curl.exe -L -o $dest $url
          Start-Process -FilePath $dest -ArgumentList "/VERYSILENT", "/DIR=$installPath" -Wait
          
          # Crear acceso directo en el escritorio
          $ws = New-Object -ComObject WScript.Shell
          $s = $ws.CreateShortcut("$env:USERPROFILE\Desktop\Telegram.lnk")
          $s.TargetPath = "$installPath\Telegram.exe"
          $s.Save()

      - name: üéÆ 5. INSTALAR DISCORD PTB
        shell: powershell
        run: |
          $url = "https://discord.com/api/downloads/distributions/app/installers/latest?channel=ptb&platform=win&arch=x64"
          $dest = "$env:TEMP\DiscordPTBSetup.exe"
          
          Write-Host "Descargando e Instalando Discord PTB..."
          curl.exe -L -o $dest $url
          Start-Process -FilePath $dest -ArgumentList "/S" -Wait
          
          # Esperar a que Discord se desempaquete
          Start-Sleep -Seconds 12
          $discordPath = Get-ChildItem -Path "$env:LOCALAPPDATA\DiscordPTB\app-*\DiscordPTB.exe" | Select-Object -ExpandProperty FullName -First 1
          
          if ($discordPath) {
              $ws = New-Object -ComObject WScript.Shell
              $s = $ws.CreateShortcut("$env:USERPROFILE\Desktop\DiscordPTB.lnk")
              $s.TargetPath = $discordPath
              $s.Save()
          }

      - name: üì∏ 6. EVIDENCIA GOFILE
        shell: powershell
        run: |
          # Captura de pantalla para ver que todo est√© en orden
          Add-Type -AssemblyName System.Windows.Forms, System.Drawing
          $s = [System.Windows.Forms.Screen]::PrimaryScreen.Bounds
          $b = New-Object System.Drawing.Bitmap($s.Width, $s.Height)
          $g = [System.Drawing.Graphics]::FromImage($b)
          $g.CopyFromScreen(0, 0, 0, 0, $b.Size)
          $imgPath = "C:\Users\Public\evidence.png"
          $b.Save($imgPath)

          # Subida a Gofile
          $serverResp = curl.exe -s https://api.gofile.io/servers
          $server = ($serverResp | ConvertFrom-Json).data.servers[0].name
          $uploadResp = curl.exe -F "file=@$imgPath" "https://$($server).gofile.io/contents/uploadfile"
          $downloadPage = ($uploadResp | ConvertFrom-Json).data.downloadPage
          
          Write-Host "----------------------------------------"
          Write-Host "LINK DE CAPTURA: $downloadPage"
          Write-Host "----------------------------------------"

      - name: üîÑ LOOP INFINITO
        shell: powershell
        run: |
          Write-Host "Runner Activo mediante HopToDesk..."
          while($true) { Start-Sleep 60 }
          
