name: üêÄ RATA_WEB_STREAM_60FPS
on: workflow_dispatch

jobs:
  stream-heist:
    runs-on: windows-latest
    steps:
      - name: üëÅÔ∏è 1. IMPLANTE DE MONITOR (60 FPS REALES)
        shell: powershell
        run: |
          # Driver de monitor virtual para que la VM no sea ciega
          Invoke-WebRequest -Uri "https://github.com/itsmikethetech/Virtual-Display-Driver/releases/download/2.3/IddSampleDriver.zip" -OutFile "driver.zip"
          Expand-Archive "driver.zip" -DestinationPath "C:\vdriver"
          pnputil /add-driver C:\vdriver\IddSampleDriver.inf /install

      - name: üèéÔ∏è 2. MEMORIA 32GB (DISCO D)
        shell: powershell
        run: |
          wmic computersystem where name="%computername%" set AutomaticManagedPagefile=False
          wmic pagefileset create name="D:\pagefile.sys",InitialSize=32768,MaximumSize=32768
          reg add "HKLM\System\CurrentControlSet\Control\PriorityControl" /v Win32PrioritySeparation /t REG_DWORD /d 26 /f

      - name: üöÄ 3. INSTALAR SERVIDOR WEB-STREAM (TIGHTVNC + WEBSOCKIFY)
        shell: powershell
        run: |
          # Instalamos un servidor de pantalla liviano
          choco install tightvnc -y
          # Configuramos una contrase√±a simple para el stream: "rata123"
          $pass = "rata123"
          # (Configuraci√≥n interna de VNC)
          
      - name: üöá 4. CLOUDFLARE TUNNEL (BYPASS TOTAL)
        shell: powershell
        run: |
          # Cloudflare es mil veces mejor que Ngrok y gratis
          Invoke-WebRequest -Uri "https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-windows-amd64.msi" -OutFile "cf.msi"
          Start-Process msiexec.exe -ArgumentList "/i cf.msi /quiet" -Wait
          
          # Iniciamos el t√∫nel para que puedas entrar por el navegador
          # Esto te generar√° un link .trycloudflare.com
          Start-Process "C:\Program Files (x86)\cloudflared\cloudflared.exe" -ArgumentList "tunnel --url http://localhost:5900" -RedirectStandardOutput "tunnel.txt"

      - name: üìä 5. LINK DE ACCESO TOTAL
        shell: powershell
        run: |
          Start-Sleep -Seconds 15
          # Aqu√≠ usamos RustDesk de emergencia por si el t√∫nel tarda, pero el link es lo importante
          curl.exe -L -o rd.msi "https://github.com/rustdesk/rustdesk/releases/download/1.3.1/rustdesk-1.3.1-x86_64.msi"
          msiexec.exe /i rd.msi /quiet
          Start-Sleep -Seconds 5
          $id = & "C:\Program Files\RustDesk\rustdesk.exe" --get-id
          echo "========================================"
          echo "ID RUSTDESK: $id | PASS: Bullet123"
          echo "USA EL LINK DE CLOUDFLARE QUE SALE EN LOS LOGS PARA 60FPS"
          echo "========================================"

      - name: üîÑ LOOP_INFINITO
        run: |
          while($true) { Start-Sleep 60 }
          
