name: RDP_PLAYIT_V4
on: workflow_dispatch

jobs:
  deploy:
    runs-on: windows-latest
    steps:
      - name: 1. SETUP RDP
        shell: powershell
        run: |
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -Name "fDenyTSConnections" -Value 0
          Enable-NetFirewallRule -DisplayGroup "Remote Desktop"
          net user boosito Parinuxd123 /add
          net localgroup administrators boosito /add

      - name: 2. EJECUTAR PLAYIT (NUEVO COMANDO)
        shell: powershell
        run: |
          curl.exe -L -o playit.exe "https://github.com/playit-cloud/playit-agent/releases/latest/download/playit-windows-x86_64.exe"
          
          # 'run' es el comando correcto para las versiones nuevas
          Start-Process -FilePath .\playit.exe -ArgumentList "run" -RedirectStandardOutput "playit.log" -RedirectStandardError "playit_err.log"
          
          Write-Host "Esperando 30 segundos para generar el link..."
          Start-Sleep -Seconds 30

      - name: 3. EXTRAER URL DE RECLAMO
        shell: powershell
        run: |
          Write-Host "========================================"
          if (Test-Path "playit.log") {
              $content = Get-Content "playit.log"
              # Buscamos el link de reclamo (claim)
              $claim = $content | Select-String "https://playit.gg/claim/"
              if ($claim) {
                  Write-Host "üîó ABRE ESTE LINK PARA ACTIVAR:"
                  Write-Host $claim
              } else {
                  Write-Host "‚ö†Ô∏è No se hallo link aun. Revisa el log completo abajo:"
                  $content | Select-Object -Last 20
              }
          }
          Write-Host "========================================"
          Write-Host "USER: boosito | PASS: Parinuxd123"

      - name: 4. MANTENER VIVO
        shell: powershell
        run: |
          while($true) { 
            Write-Host "Runner Activo - $(Get-Date)"
            Start-Sleep -Seconds 60 
          }
          
