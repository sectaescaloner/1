name: RATA_W11_GLOOSO_FIXED
on: workflow_dispatch

jobs:
  gaming-heist:
    runs-on: windows-latest
    steps:
      - name: üá®üá± 1. REGION Y NOMBRE
        shell: powershell
        run: |
          Set-WinHomeLocation -GeoId 46
          $n = "Glooso"
          Set-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Control\ComputerName\ComputerName" -Name "ComputerName" -Value $n

      - name: üîë 2. ARREGLAR HOPTODESK (MODO PORTABLE)
        shell: powershell
        run: |
          # Descarga
          curl.exe -L -o "hoptodesk.exe" "https://download.hoptodesk.com/HopToDesk64.exe"
          
          # Lanzar HopToDesk en segundo plano primero para que genere el ID
          Start-Process -FilePath ".\hoptodesk.exe"
          Start-Sleep -Seconds 8
          
          # Ahora intentamos poner el pass sin que muera el proceso
          ./hoptodesk.exe --password boosito
          
          $id = ./hoptodesk.exe --get-id
          Write-Host "========================================"
          Write-Host "ID HOPTODESK: $id"
          Write-Host "PASS: boosito"
          Write-Host "========================================"

      - name: ‚úàÔ∏è 3. INSTALAR TELEGRAM (SIN EJECUTAR)
        shell: powershell
        run: |
          $url = "https://telegram.org/dl/desktop/win64"
          $dest = "$env:TEMP\telegram_setup.exe"
          curl.exe -L -o $dest $url
          
          Write-Host "Instalando Telegram silenciosamente..."
          # /VERYSILENT instala, /NORESTART evita reinicios, y no usamos flags de auto-ejecuci√≥n
          Start-Process -FilePath $dest -ArgumentList "/VERYSILENT", "/DIR=C:\Telegram", "/NOICONS" -Wait
          
          # Crear el acceso directo para que lo abras cuando quieras
          $ws = New-Object -ComObject WScript.Shell
          $s = $ws.CreateShortcut("$env:USERPROFILE\Desktop\Telegram.lnk")
          $s.TargetPath = "C:\Telegram\Telegram.exe"
          $s.Save()

      - name: üéÆ 4. SOLO DESCARGAR DISCORD PTB
        shell: powershell
        run: |
          $url = "https://discord.com/api/downloads/distributions/app/installers/latest?channel=ptb&platform=win&arch=x64"
          $dest = "$env:USERPROFILE\Desktop\Instalar_Discord_PTB.exe"
          
          Write-Host "Descargando Discord al Escritorio..."
          curl.exe -L -o $dest $url

      - name: üì∏ 5. EVIDENCIA GOFILE
        shell: powershell
        run: |
          Add-Type -AssemblyName System.Windows.Forms, System.Drawing
          $s = [System.Windows.Forms.Screen]::PrimaryScreen.Bounds
          $b = New-Object System.Drawing.Bitmap($s.Width, $s.Height)
          $g = [System.Drawing.Graphics]::FromImage($b)
          $g.CopyFromScreen(0, 0, 0, 0, $b.Size)
          $imgPath = "C:\Users\Public\evidence.png"
          $b.Save($imgPath)
          
          $server = (curl.exe -s https://api.gofile.io/servers | ConvertFrom-Json).data.servers[0].name
          $link = (curl.exe -F "file=@$imgPath" "https://$($server).gofile.io/contents/uploadfile" | ConvertFrom-Json).data.downloadPage
          Write-Host "----------------------------------------"
          Write-Host "CAPTURA: $link"
          Write-Host "----------------------------------------"

      - name: üîÑ LOOP
        shell: powershell
        run: |
          Write-Host "Runner Activo. Telegram instalado (cerrado) y Discord listo en escritorio."
          while($true) { Start-Sleep 60 }
          
