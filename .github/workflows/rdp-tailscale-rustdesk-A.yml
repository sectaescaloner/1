name: üêÄ RATA_SUNSHINE_PRO_TUNNEL
on: workflow_dispatch

jobs:
  gaming-heist:
    runs-on: windows-latest
    steps:
      - name: üèéÔ∏è 1. RAM 32GB (M√âTODO REGISTRO)
        shell: powershell
        run: |
          reg add "HKLM\System\CurrentControlSet\Control\Session Manager\Memory Management" /v PagingFiles /t REG_MULTI_SZ /d "D:\pagefile.sys 32768 32768" /f
          Write-Host "[OK] RAM lista."

      - name: üëÅÔ∏è 2. INSTALAR MONITOR VIRTUAL (TU LINK GANADOR)
        shell: powershell
        run: |
          $url = "https://github.com/VirtualDrivers/Virtual-Display-Driver/releases/download/25.5.2/Virtual.Display.Driver-v25.05.03-setup-x64.exe"
          curl -L -o setup_monitor.exe $url
          Start-Process -FilePath ".\setup_monitor.exe" -ArgumentList "/S" -Wait
          Write-Host "[OK] Ojos instalados."

      - name: ‚òÄÔ∏è 3. SUNSHINE (EL REY)
        shell: powershell
        run: |
          choco install sunshine -y
          Write-Host "[OK] Sunshine instalado."

      - name: üöá 4. CLOUDFLARE TUNNEL (EL SALTA-FIREWALLS)
        shell: powershell
        run: |
          # Descargamos el t√∫nel para saltar el firewall de Microsoft
          curl -L -o cloudflared.msi https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-windows-amd64.msi
          msiexec.exe /i cloudflared.msi /quiet
          
          Write-Host "--- ESPERANDO AL LINK DEL T√öNEL ---"
          # Creamos el t√∫nel para el panel de Sunshine (Puerto 47990)
          Start-Process "C:\Program Files (x86)\cloudflared\cloudflared.exe" -ArgumentList "tunnel --url http://localhost:47990" -RedirectStandardOutput "tunnel_log.txt"
          Start-Sleep -Seconds 15
          Get-Content "tunnel_log.txt" | Select-String "trycloudflare.com"

      - name: üéÆ 5. BOOSTER: MESA3D Y CONTROLES
        shell: powershell
        run: |
          choco install mesa3d-pal1000 vigembus -y
          Write-Host "[OK] Configuraci√≥n gaming lista."

      - name: üîÑ MANTENER VIVO
        run: |
          while($true) { Start-Sleep 60 }
          
