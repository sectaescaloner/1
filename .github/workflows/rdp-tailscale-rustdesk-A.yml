name: RUSTDESK_PARINUX_ULTIMATE
on: workflow_dispatch

jobs:
  deploy-remote:
    runs-on: windows-latest
    steps:
      - name: üó∫Ô∏è 1. LOCALIZAR RUNNER (PARA TU VPN)
        shell: powershell
        run: |
          $info = curl.exe -s https://ipinfo.io/json | ConvertFrom-Json
          Write-Host "========================================"
          Write-Host "üåç UBICACI√ìN DEL RUNNER: $($info.city), $($info.country)"
          Write-Host "üìç IP P√öBLICA: $($info.ip)"
          Write-Host "üåê PROVEEDOR: $($info.org)"
          Write-Host "========================================"
          Write-Host "üëâ TIP: Usa una VPN en tu celular conectada a $($info.country) para evitar bloqueos."
          Write-Host "========================================"

      - name: üõ°Ô∏è 2. PREPARAR SISTEMA
        shell: powershell
        run: |
          Set-NetFirewallProfile -Profile Domain,Public,Private -Enabled False
          Set-WinHomeLocation -GeoId 46 

      - name: üöÄ 3. INSTALAR RUSTDESK (PASS: parinuxd)
        shell: powershell
        run: |
          $url = "https://github.com/rustdesk/rustdesk/releases/download/1.3.7/rustdesk-1.3.7-x86_64.exe"
          $exe = "$env:TEMP\rustdesk.exe"
          curl.exe -L -o $exe $url
          
          Write-Host "Instalando RustDesk como servicio..."
          Start-Process -FilePath $exe -ArgumentList "--install" -Wait
          
          Start-Sleep -Seconds 10
          
          # Forzar contrase√±a fija 'parinuxd'
          try {
              & "C:\Program Files\RustDesk\rustdesk.exe" --password parinuxd
              Write-Host "‚úÖ Contrase√±a 'parinuxd' configurada correctamente."
          } catch {
              Write-Host "‚ö†Ô∏è Error al setear pass, intentando m√©todo alternativo..."
              cmd.exe /c "echo parinuxd | `"C:\Program Files\RustDesk\rustdesk.exe`" --password parinuxd"
          }

      - name: üÜî 4. OBTENER ID Y CAPTURA
        shell: powershell
        run: |
          $id = & "C:\Program Files\RustDesk\rustdesk.exe" --get-id
          Write-Host "========================================"
          Write-Host "üÜî TU ID RUSTDESK: $id"
          Write-Host "üîë CONTRASE√ëA: parinuxd"
          Write-Host "========================================"
          
          # Captura de pantalla por si el ID no sale en consola
          Add-Type -AssemblyName System.Windows.Forms, System.Drawing
          $s = [System.Windows.Forms.Screen]::PrimaryScreen.Bounds
          $b = New-Object System.Drawing.Bitmap($s.Width, $s.Height)
          $g = [System.Drawing.Graphics]::FromImage($b)
          $g.CopyFromScreen(0, 0, 0, 0, $b.Size)
          $imgPath = "C:\Users\Public\rust_final.png"
          $b.Save($imgPath)
          
          $server = (curl.exe -s https://api.gofile.io/servers | ConvertFrom-Json).data.servers[0].name
          $link = (curl.exe -F "file=@$imgPath" "https://$($server).gofile.io/contents/uploadfile" | ConvertFrom-Json).data.downloadPage
          Write-Host "üñºÔ∏è VER PANTALLA Y CONFIRMAR ID: $link"

      - name: üîÑ 5. MANTENER CONEXI√ìN
        shell: powershell
        run: |
          Write-Host "üöÄ Todo listo. Con√©ctate ahora."
          while($true) { Start-Sleep 60 }

