name: üêÄ RATA_SUNSHINE_TAILSCALE
on: 
  workflow_dispatch:
    inputs:
      tailscale_key:
        description: 'Tu Auth Key de Tailscale'
        required: true

jobs:
  gaming-heist:
    runs-on: windows-latest
    steps:
      - name: üèéÔ∏è 1. RAM 32GB (REGISTRO)
        shell: powershell
        run: |
          reg add "HKLM\System\CurrentControlSet\Control\Session Manager\Memory Management" /v PagingFiles /t REG_MULTI_SZ /d "D:\pagefile.sys 32768 32768" /f

      - name: üëÅÔ∏è 2. MONITOR VIRTUAL (TU LINK GANADOR)
        shell: powershell
        run: |
          $url = "https://github.com/VirtualDrivers/Virtual-Display-Driver/releases/download/25.5.2/Virtual.Display.Driver-v25.05.03-setup-x64.exe"
          curl -L -o setup_monitor.exe $url
          Start-Process -FilePath ".\setup_monitor.exe" -ArgumentList "/S" -Wait

      - name: üöá 3. TAILSCALE (EL TUNEL DEFINITIVO)
        shell: powershell
        run: |
          # Instalamos Tailscale para saltar el Firewall de Microsoft
          choco install tailscale -y
          # Nos conectamos a tu red privada
          & "C:\Program Files\Tailscale\tailscale.exe" up --authkey ${{ github.event.inputs.tailscale_key }}

      - name: ‚òÄÔ∏è 4. SUNSHINE (EL REY)
        shell: powershell
        run: |
          choco install sunshine -y
          # Inyectamos Mesa3D para que el AMD EPYC act√∫e como GPU
          choco install mesa3d-pal1000 vigembus -y

      - name: üìä 5. DATOS DE CONEXI√ìN
        shell: powershell
        run: |
          $ip = & "C:\Program Files\Tailscale\tailscale.exe" ip -4
          Write-Host "========================================"
          Write-Host "IP PRIVADA TAILSCALE: $ip"
          Write-Host "1. Abre Moonlight en tu cel (conectado a Tailscale)."
          Write-Host "2. Agrega la IP: $ip"
          Write-Host "3. Si necesitas configurar Sunshine: https://$($ip):47990"
          Write-Host "========================================"

      - name: üîÑ MANTENER VIVO
        run: |
          while($true) { Start-Sleep 60 }
          
