name: RDP_RUSTDESK_CATBOX
on:
  workflow_dispatch:
    inputs:
      runtime_minutes:
        description: "Minutos de encendido (max 360)"
        default: "355"

jobs:
  rdp:
    runs-on: windows-latest
    steps:
      - name: 1. Instalar RustDesk
        shell: pwsh
        run: |
          $url = "https://github.com/rustdesk/rustdesk/releases/download/1.3.1/rustdesk-1.3.1-x86_64.msi"
          Invoke-WebRequest -Uri $url -OutFile "rustdesk.msi"
          Start-Process msiexec.exe -ArgumentList "/i","rustdesk.msi","/quiet","/norestart" -Wait

      - name: 2. Configurar y Capturar a Catbox
        shell: pwsh
        run: |
          $rd = "C:\Program Files\RustDesk\rustdesk.exe"
          # Configura contraseÃ±a fija
          & $rd --password "boosito123"
          Start-Sleep -Seconds 10
          
          # Sacar captura de pantalla
          $screen = "$env:TEMP\screenshot.png"
          Add-Type -AssemblyName System.Windows.Forms
          Add-Type -AssemblyName System.Drawing
          $bmp = New-Object System.Drawing.Bitmap([System.Windows.Forms.Screen]::PrimaryScreen.Bounds.Width, [System.Windows.Forms.Screen]::PrimaryScreen.Bounds.Height)
          $graphics = [System.Drawing.Graphics]::FromImage($bmp)
          $graphics.CopyFromScreen(0, 0, 0, 0, $bmp.Size)
          $bmp.Save($screen, [System.Drawing.Imaging.ImageFormat]::Png)
          $graphics.Dispose(); $bmp.Dispose()
          
          # Subir a Catbox.moe
          Write-Host "Subiendo captura a Catbox..."
          $url = curl.exe -F "reqtype=fileupload" -F "fileToUpload=@$screen" https://catbox.moe/user/api.php
          
          Write-Host "========================================"
          Write-Host "ðŸ”— LINK DE LA CAPTURA: $url"
          Write-Host "ðŸ†” BUSCA EL ID EN LA IMAGEN"
          Write-Host "ðŸ”‘ CONTRASEÃ‘A SETEADA: boosito123"
          Write-Host "========================================"

      - name: 3. Mantener Vivo
        shell: pwsh
        run: |
          $end = (Get-Date).AddMinutes(${{ inputs.runtime_minutes }})
          while ((Get-Date) -lt $end) {
            Write-Host "Ejecutando... finaliza a las $($end.ToString('HH:mm'))"
            Start-Sleep -Seconds 60
          }

