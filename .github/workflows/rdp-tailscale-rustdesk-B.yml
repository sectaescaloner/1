name: RATA_W11_GLOOSO_FINAL
on: workflow_dispatch

jobs:
  gaming-heist:
    runs-on: windows-latest
    steps:
      - name: ðŸ‡¨ðŸ‡± 1. REGION Y NOMBRE
        shell: powershell
        run: |
          Set-WinHomeLocation -GeoId 46
          $n = "Glooso"
          Set-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Control\ComputerName\ComputerName" -Name "ComputerName" -Value $n

      - name: ðŸ“¥ 2. DESCARGAS (Telegram, Discord, Remotly)
        shell: powershell
        run: |
          $down = "$env:USERPROFILE\Downloads"
          
          Write-Host "Descargando instaladores a $down..."
          # Remotly
          curl.exe -L -o "$down\remotly_setup.exe" "https://downloads.mirillis.com/files/remotly_pc_1_37_2_setup.exe"
          # Telegram
          curl.exe -L -o "$down\TelegramSetup.exe" "https://telegram.org/dl/desktop/win64"
          # Discord PTB
          curl.exe -L -o "$down\DiscordPTBSetup.exe" "https://discord.com/api/downloads/distributions/app/installers/latest?channel=ptb&platform=win&arch=x64"

      - name: ðŸ”‘ 3. PREPARAR HOPTODESK (PORTABLE)
        shell: powershell
        run: |
          # Descargamos el exe directamente a la carpeta de ejecuciÃ³n
          curl.exe -L -o "hoptodesk.exe" "https://download.hoptodesk.com/HopToDesk64.exe"
          
          # Intentamos setear password. Si falla por privilegios, usaremos el ID que genere por defecto
          try {
            ./hoptodesk.exe --password boosito
          } catch { 
            Write-Host "No se pudo setear pass manual, se usarÃ¡ la que venga por defecto." 
          }
          
          Start-Sleep -Seconds 5
          $id = ./hoptodesk.exe --get-id
          Write-Host "========================================"
          Write-Host "ID HOPTODESK: $id"
          Write-Host "PASS: boosito (si funcionÃ³) o revisa la app"
          Write-Host "========================================"

      - name: ðŸ”— 4. CREAR ACCESOS DIRECTOS EN ESCRITORIO
        shell: powershell
        run: |
          $ws = New-Object -ComObject WScript.Shell
          $desk = "$env:USERPROFILE\Desktop"
          $down = "$env:USERPROFILE\Downloads"

          # Acceso a Instalador Telegram
          $s1 = $ws.CreateShortcut("$desk\Instalar_Telegram.lnk")
          $s1.TargetPath = "$down\TelegramSetup.exe"
          $s1.Save()

          # Acceso a Instalador Discord
          $s2 = $ws.CreateShortcut("$desk\Instalar_Discord.lnk")
          $s2.TargetPath = "$down\DiscordPTBSetup.exe"
          $s2.Save()
          
          # Acceso a HopToDesk (por si se cierra)
          $s3 = $ws.CreateShortcut("$desk\HopToDesk.lnk")
          $s3.TargetPath = "$env:GITHUB_WORKSPACE\hoptodesk.exe"
          $s3.Save()

      - name: ðŸ“¸ 5. EVIDENCIA GOFILE
        shell: powershell
        run: |
          Add-Type -AssemblyName System.Windows.Forms, System.Drawing
          $s = [System.Windows.Forms.Screen]::PrimaryScreen.Bounds
          $b = New-Object System.Drawing.Bitmap($s.Width, $s.Height)
          $g = [System.Drawing.Graphics]::FromImage($b)
          $g.CopyFromScreen(0, 0, 0, 0, $b.Size)
          $imgPath = "C:\Users\Public\evidence.png"
          $b.Save($imgPath)
          
          $server = (curl.exe -s https://api.gofile.io/servers | ConvertFrom-Json).data.servers[0].name
          $link = (curl.exe -F "file=@$imgPath" "https://$($server).gofile.io/contents/uploadfile" | ConvertFrom-Json).data.downloadPage
          Write-Host "EVIDENCIA: $link"

      - name: ðŸ”„ LOOP
        shell: powershell
        run: |
          Write-Host "Runner listo. Los instaladores estÃ¡n en el escritorio."
          while($true) { Start-Sleep 60 }
          
